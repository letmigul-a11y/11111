<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>ToDo - Версія C</title>
    <style>
        body { font-family: 'Times New Roman', serif; background-color: #f5f5f5; padding: 20px; }
        .wrap { max-width: 450px; margin: 0 auto; background: white; padding: 20px; border: 1px solid #ccc; }
        h1 { text-align: center; color: #555; margin-bottom: 15px; }
        #in { width: 100%; padding: 8px; border: 1px solid #777; margin-bottom: 10px; }
        .list { list-style: none; padding: 0; }
        .item { display: flex; align-items: center; padding: 5px 0; border-bottom: 1px dotted #ddd; }
        .text { flex-grow: 1; margin-left: 10px; cursor: pointer; }
        .date { font-size: 10px; color: #999; margin-left: auto; margin-right: 10px; }
        .del { color: #555; cursor: pointer; font-size: 12px; font-weight: bold; }
        .done-status { text-decoration: line-through; color: #aaa; font-style: italic; }
        .controls { margin-top: 15px; }
        .controls button { margin-right: 5px; padding: 5px; border: 1px solid #777; background: #fff; cursor: pointer; }
        .controls button.active { background-color: #555; color: white; }
    </style>
</head>
<body>

    <div class="wrap">
        <h1>Список Завдань</h1>
        <input type="text" id="in" placeholder="Нове завдання (Enter)">
        
        <div class="controls">
            <button onclick="app.setFilter('all')" class="active">Усі</button>
            <button onclick="app.setFilter('active')">Активні</button>
            <button onclick="app.setFilter('completed')">Завершені</button>
        </div>

        <ul class="list" id="list"></ul>
    </div>

<script>
class TaskApp {
    constructor() {
        this.tasks = [];
        this.filter = 'all';
        this.init();
    }

    init() {
        const data = localStorage.getItem('anon_tasks_c'); // Завдання 7: Зберігання у браузері
        if (data) this.tasks = JSON.parse(data);
        this.bind();
        this.render();
    }

    save() {
        localStorage.setItem('anon_tasks_c', JSON.stringify(this.tasks));
    }

    bind() {
        document.getElementById('in').addEventListener('keyup', (e) => {
            if (e.key === 'Enter') { // Завдання 1: Додавання по Enter
                this.add(e.target.value.trim());
                e.target.value = '';
            }
        });
        document.getElementById('list').addEventListener('click', (e) => {
            const id = e.target.closest('.item')?.dataset.id;
            if (!id) return;
            
            if (e.target.classList.contains('del')) { // Завдання 5: Видалення
                this.remove(id);
            } else if (e.target.type === 'checkbox') { // Завдання 4: Виконання
                this.toggle(id);
            }
        });
        // Завдання 6: Редагування
        document.getElementById('list').addEventListener('dblclick', (e) => {
            const textEl = e.target.closest('.item')?.querySelector('.text');
            if (textEl && !textEl.closest('.item').classList.contains('done-status')) {
                this.edit(textEl);
            }
        });
    }

    // Завдання 1 & 2: Додавання
    add(text) {
        if (!text) return;
        const t = {
            id: Date.now().toString(),
            text: text,
            date: this.timeFormat(new Date()), // Дата та час [cite: 1076]
            isDone: false
        };
        this.tasks.push(t);
        this.save();
        this.render();
    }

    // Завдання 2: Форматування часу
    timeFormat(d) {
        const day = d.getDate().toString().padStart(2, '0');
        const month = (d.getMonth() + 1).toString().padStart(2, '0');
        const year = d.getFullYear().toString().slice(-2);
        const hour = d.getHours().toString().padStart(2, '0');
        const minute = d.getMinutes().toString().padStart(2, '0');
        return `${day}.${month}.${year}, ${hour}:${minute}`; // [cite: 1076]
    }

    // Завдання 4: Виконання
    toggle(id) {
        const task = this.tasks.find(t => t.id === id);
        if (task) {
            task.isDone = !task.isDone; // Перекреслюється і стає сірого кольору [cite: 1078]
            this.save();
            this.render();
        }
    }

    // Завдання 5: Видалення
    remove(id) {
        this.tasks = this.tasks.filter(t => t.id !== id);
        this.save();
        this.render();
    }
    
    // Завдання 6: Редагування
    edit(textEl) {
        const original = textEl.textContent;
        const id = textEl.closest('.item').dataset.id;
        
        const editor = document.createElement('input'); // З'являється <input> [cite: 1080]
        editor.type = 'text';
        editor.value = original;
        editor.style.width = '100%';

        textEl.replaceWith(editor);
        editor.focus();

        const finish = () => {
            const newText = editor.value.trim();
            const task = this.tasks.find(t => t.id === id);
            
            if (newText && task) task.text = newText;
            
            editor.replaceWith(textEl); // <input> зникне [cite: 1081]
            this.save();
            this.render();
        };

        editor.addEventListener('keyup', (e) => { if (e.key === 'Enter') finish(); }); // Enter
        editor.addEventListener('blur', finish);
    }
    
    // Завдання 8: Сортування
    setFilter(f) {
        this.filter = f;
        document.querySelectorAll('.controls button').forEach(btn => btn.classList.remove('active'));
        document.querySelector(`.controls button[onclick*="'${f}'"]`).classList.add('active');
        this.render();
    }


    // Рендеринг
    render() {
        const listEl = document.getElementById('list');
        listEl.innerHTML = '';
        
        const filtered = this.tasks.filter(t => {
            if (this.filter === 'completed') return t.isDone;
            if (this.filter === 'active') return !t.isDone;
            return true;
        });

        filtered.forEach(task => {
            const li = document.createElement('li');
            li.className = `item ${task.isDone ? 'done-status' : ''}`; // Перекреслюється і стає сірого кольору [cite: 1078]
            li.dataset.id = task.id;

            const checkboxDiv = document.createElement('div');
            const checkbox = document.createElement('input'); // Завдання 3: Чекбокс
            checkbox.type = 'checkbox';
            checkbox.checked = task.isDone;
            checkboxDiv.appendChild(checkbox);

            const textSpan = document.createElement('span');
            textSpan.classList.add('text');
            textSpan.textContent = task.text;

            const dateSpan = document.createElement('span');
            dateSpan.classList.add('date');
            dateSpan.textContent = task.date;

            const deleteBtn = document.createElement('span'); // Завдання 5: Хрестик
            deleteBtn.classList.add('del');
            deleteBtn.textContent = 'x';

            li.appendChild(checkboxDiv);
            li.appendChild(textSpan);
            li.appendChild(dateSpan);
            li.appendChild(deleteBtn);
            
            // Якщо виконано, checkbox зникає [cite: 1078]
            if (task.isDone) {
                 checkboxDiv.style.display = 'none'; 
            } else {
                 checkboxDiv.style.display = 'block'; 
            }

            listEl.appendChild(li);
        });
    }
}

const app = new TaskApp();
</script>
</body>
</html>